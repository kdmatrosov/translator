<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<link rel="stylesheet" href="./style.css">
<script src="https://unpkg.com/vue/dist/vue.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/mathjs/3.11.4/math.min.js"></script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<body>
<div id="app">
    <div class="container">
        <div class="container__text">
            <textarea class="text" v-model="text"></textarea>
        </div>
        <div class="container__bnf"></div>
        <div class="container__chart"></div>
        <div class="container__error"></div>
    </div>
</div>
<div id="chart"></div>
<script>
  new Vue({
    el: '#app',
    data: {
      header: 'Транслятор',
      projects: [],
      h: 0.01,
      interval: 2,
      text: `3y”+2y’+y=0
h = 0.01
t = [0,1]`,
      toch: 4
    },
    created(){/*
     let h = math.parse('x^2 + x');
     let x = math.parse('x');
     let dh = math.derivative(h, x);
     console.log(dh.toString());
     console.log(dh.eval({x: 3}));*/
      this.main();
    },
    methods: {
      main(){
        //3y”+2y’+y=0
        let x = [0];
        let y = [1];
        const a = 3, b = 2 / a, c = 1 / a;
        this.eiler(x, y, b, c);
      },
      eiler(x = [0], y = [0], b, c){
        let h = 0.01 || this.h;
        const tn = 1, t0 = 0;
        //Расчет числа шагов
        const n = (tn - t0) / h;
        let data = [[x[0], y[0]]];
        for (let i = 1; i < n; i++) {
          x[i] = x[i - 1] + (-b * x[i - 1] - c * y[i - 1]) * h
          y[i] = y[i - 1] + x[i - 1] * h;
          console.log([+x[i].toFixed(this.toch), +y[i].toFixed(this.toch)]);
          data.push([+x[i].toFixed(this.toch), +y[i].toFixed(this.toch)]);
        }
        this.buildChart(data);
      },
      runge(x = [0], y = [0], b, c){
        let h = 0.01 || this.h;
        let kx1 = {}, kx2 = {}, kx3 = {}, kx4 = {}, deltax = {};
        let ky1 = {}, ky2 = {}, ky3 = {}, ky4 = {}, deltay = {};
        const tn = 1, t0 = 0;
        //Расчет числа шагов
        const n = (tn - t0) / h;
        let data = [[x[0], y[0]]];

        for (let i = 0; i < n; i++) {
          kx1[i] = h * (-c * y[i] - b * x[i]);
          kx2[i] = h * (-c * y[i] - b * (x[i] + kx1[i] / 2));
          kx3[i] = h * (-c * y[i] - b * (x[i] + kx2[i] / 2));
          kx4[i] = h * (-c * y[i] - b * (x[i] + kx3[i]));
          deltax[i] = 1 / 6 * (kx1[i] + 2 * kx2[i] + 2 * kx3[i] + kx4[i]);
          x[i + 1] = x[i] + deltax[i];
          ky1[i] = h * x[i];
          ky2[i] = h * (x[i] + ky1[i] / 2);
          ky3[i] = h * (x[i] + ky2[i] / 2);
          ky4[i] = h * (x[i] + ky3[i]);
          deltay[i] = 1 / 6 * (ky1[i] + 2 * ky2[i] + 2 * ky3[i] + ky4[i]);
          y[i + 1] = y[i] + deltay[i];
          console.log([+x[i].toFixed(this.toch), +y[i].toFixed(this.toch)]);
          data.push([+x[i].toFixed(this.toch), +y[i].toFixed(this.toch)]);
        }
        this.buildChart(data);
      },
      buildChart(data)
      {
        Highcharts.chart('chart', {
          title: {
            text: 'График'
          },
          credits: {
            enabled: false
          },
          xAxis: {
            legend: {
              enabled: false
            }
          },
          legend: {
            enabled: false
          },
          plotOptions: {
            series: {
              lineWidth: 1,
              states: {
                lineWidth: 1,
                hover: {
                  lineWidth: 1
                }
              },
              marker: {
                radius: 3,
                symbol: 'triangle',
                states: {
                  hover: {
                    radius: 3
                  }
                }
              },
              color: '#7f76e9'
            }

          }, tooltip: {
            formatter: function () {
              return '<b>' + this.x +
                '</b> , <b>' + this.y + '</b>';
            }
          },
          series: [{
            data: data.sort((a, b) => a[0] < b[0] ? -1 : (a[0] > b[0] ? 1 : 0))
          }]
        });
      }
    }

  });
</script>
</body>
</html>